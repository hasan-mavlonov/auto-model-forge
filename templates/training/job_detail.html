{% extends "base.html" %}

{% block content %}
  <h1>Training job: {{ job.project_name }}</h1>

  <p><strong>ID:</strong> {{ job.public_id }}</p>
  <p><strong>Status:</strong> {{ job.get_status_display }}</p>
  <p><strong>Model type:</strong> {{ job.model_type.name }}</p>
  <p><strong>Base model:</strong> {{ job.base_model.name }}</p>
  <p><strong>Images:</strong> {{ job.num_images }}</p>
  <p><strong>Total price:</strong> ${{ job.total_price }}</p>

  {% if job.status == "awaiting_payment" %}
    <p>Next step: pay for this job.</p>

    {# ВРЕМЕННО: имитация успешной оплаты.
       Потом здесь будет Stripe Checkout. #}
    <a href="{% url 'payments:success' job.public_id %}">
      <button type="button">Pay (mock, mark as paid)</button>
    </a>
  {% endif %}

  {% if countdown_seconds %}
    <p><strong>Training deadline:</strong> {{ job.deadline_at }}</p>
    <p>Time left for delivering your model:
      <span id="countdown"></span>
    </p>

    <script>
      (function() {
        let remaining = {{ countdown_seconds|default:0 }};
        const el = document.getElementById("countdown");
        if (!el) return;

        function tick() {
          if (remaining < 0) return;
          const hours = Math.floor(remaining / 3600);
          const minutes = Math.floor((remaining % 3600) / 60);
          const seconds = remaining % 60;

          el.textContent =
            String(hours).padStart(2, "0") + ":" +
            String(minutes).padStart(2, "0") + ":" +
            String(seconds).padStart(2, "0");

          remaining -= 1;
          if (remaining >= 0) {
            setTimeout(tick, 1000);
          }
        }

        tick();
      })();
    </script>
  {% endif %}

  {% if job.status == "completed" and job.artifact %}
    <p>Your model is ready:</p>
    {% if job.artifact.download_url %}
      <a href="{{ job.artifact.download_url }}" target="_blank">Download model</a>
    {% elif job.artifact.file %}
      <a href="{{ job.artifact.file.url }}" target="_blank">Download model</a>
    {% endif %}
  {% endif %}
{% endblock %}
